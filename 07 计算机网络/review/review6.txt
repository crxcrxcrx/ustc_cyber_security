6 网络层

6.1 网络层向传输层提供的服务
    较远的局域网需要结构化统一的地址编排
    二层交换机不隔离广播域, 容易形成网络风暴
    技术目标
        服务与通信子网技术无关
        对传输层而言, 通信子网数量, 类型和拓扑结构是隐蔽的
        网络地址需要统一编号
    无连接的服务
        Internet社区
        数据报网络IP
    面向连接的服务
        电话公司
        虚电路网络ATM

6.2 数据报与虚电路
    VC 
        Virtual Circuit
        虚电路
    VCI
        Virtual Circuit Identifier
        虚电路标识
    LCN
        Logical Channel Number
        逻辑信道号
    OSI网络层提供两种服务
        数据报, 无连接
            不需要进行连接, 直接发送
            每个分组头包含目的地址, 且在节点分别被单独处理, 可以走不同路径
            特点
                有转发表来确定分组转发
                寻路独立, 可合理利用网络资源
                可能先发后到
                分组必须有生存时间限制, 到时间就抛弃, 否则会网络风暴
        虚电路, 面向连接
            发出连接请求, 建立连接, 通信, 拆除连接
            每个分组只需携带链路范围有效的VCI, 能标识自己的VC即可
            特点
                建立连接时就已分配资源, 带宽独占, 延时预设定, 质量有保证
                一条虚电路可对应多条逻辑信道
                由逻辑信道级联形成, 会占用节点缓存器的一个储存空间
                有效防止拥塞

6.3 路由算法
    DV
        Distance Vector
        距离矢量, 一种算法
    LS
        Link State
        链路状态, 一种算法
    DVR
        Distance Vector Routing
        距离矢量路由
    RIP
        Route Information Protocol
        路由信息协议
    OSPF
        Open Shortest Path First
        开放最短路径优先协议
    IGRP
        Interior Gateway Routing Protocol
        内部网关路由协议
    SPF
        Shortest Path First
        最短路径优先, 链路状态算法别称
    IGP 
        Interior Gateway Protocols
        内部网关协议
    EGP 
        Exterior Gateway Protocols
        外部网关协议
    AS
        Autonomous System 
        自治系统
    网络层主要目的是根据分组目的地址选择路径
        数据报, 每个分组单独寻路
        虚电路, 建立连接就要寻路
    算法有两类, 非自适应和自适应
    非自适应
        静态路由, 路由表固定
        简便可靠易行
        适用于拓扑结构稳定或变化不大的网络以及用户主机
    自适应
        动态路由, 根据路由协议定时刷新路由表
        算法复杂, 会增加网络负担, 但能根据网络状态动态调整路由表
        适用于路由器
        自适应路由算法有两类, 距离矢量算法和链路状态算法
        距离矢量算法(DV, 对应RIP协议)
            每个节点定期向相邻路由节点交换路由表
            路由表内容有目的地址(矢量)和到达目的地址的代价(距离)
            根据收到的路由表信息更新自己的路由表
            Bellman Ford算法!
            问题
                可能存在寻路环
                收敛慢
                无穷计算(对好消息反应快但坏消息反应慢)
            解决方法
                水平分割法
                即不会循环转发, 防止路由器向邻居返回一个从邻居获得的最佳路径
        链路状态算法(LS, 对应OSPF协议)
            每个节点主动测试相邻节点的状态
            定期将相邻节点状态给所有节点
            每个节点都有完整网络拓扑信息, 然后计算最佳路径
            Dijkstra算法!
            问题
                需要对全网信息掌握
            解决方法
                降低子网复杂度来减少子网路由器数量
        DV和LS区别和特点
            DV
                节点向相邻节点告诉它所知道的所有节点路由信息
                节点根据相邻节点路由更新自己的路由表
                分布式计算
                可扩展性差
            LS
                节点向所有节点告诉它相邻节点的状态信息
                每个节点都有全局拓扑结构
                根据拓扑结构集中计算路由表
                可扩展性好
        层次路由
            网络规模变大, 路由表变大, 占用更多内存带宽和查找时间
            将网络分区
                区内互相转发(用DV或LS)
                区外给指定路由(边界路由器)
            路由信息和状态信息交换仅在域内进行, 因此路由表变小
            大型网络可以分多层, 上层只看到边界路由, 本层可看到全部路由 
            问题
                路径可能并非最佳, 但是无伤大雅

6.4 流量控制与拥塞控制
    RED
        Random Early Detection 
        随机早期检测
    流量控制
        局部问题, 只涉及收发两端
        发送速度大于接收速度导致
    拥塞控制
        全局问题, 主机和路由器等设备均会波及
        网络负载不均衡, 路由器收发速度不匹配
            对无连接的网络很难在网络层控制住, 因此需要网络层传输层一起控制
        现象
            大量分组进入子网超过网络处理能力, 则网络局部或整体性能下降
            路由器队列溢出, 分组丢失
        原因
            路由器处理速度, 存储空间和带宽不匹配
            网络负载不平衡
        后果
            许多分组需要重传
            重传继续消耗带宽, 正反馈导致负荷越来越大, 直至崩溃
        控制原理
            开环控制(基于良好设计, 进行业务量整形)
                整流限速
                漏桶算法(直接限速)
                    漏桶滴完时间t(数据传输时间)
                    漏桶容量B(发送的数据量)
                    以恒定速率R漏桶(即发送速率限制)
                    t=B/R
                令牌桶算法(允许一定突发流量)
                    漏桶滴完时间t(数据传输时间)
                    漏桶容量B(发送的数据量)
                    令牌桶发完时间T(迅速发送的时间)
                    令牌桶容量C(允许迅速发送的最大量)
                    最大输出速率M(迅速发送的速率)
                    令牌产生速率R(而后恒定的速率)
                    C+RT=MT, t=T+(B-T*M)/R
            闭环控制(基于反馈概念, 进行监测与调整)
                由主机或路由器发送询问分组获取拥塞情况
                分组头保留位或域用于通知拥塞信息
                检测到拥塞, 就告诉源端或者直接广播所有主机
                虚电路拥塞控制
                    建立连接时便预留资源 
                    如果拥塞, 则拒绝建立新的虚电路
                    建立虚电路会绕开拥塞区域
                数据报拥塞控制
                    随机早期检测(RED)
                    抑制分组
                        源抑制, 发生拥塞告诉源端, 减慢发送流量
                        逐跳抑制, 对分组发送经过的每一跳都减慢发送流量

6.5 网络互连
    L1
        中继器Repeater和集线器Hub
        无条件透明复制放大信号, 延长距离, 弥补信号衰减, 连接主机
    L2
        网桥Bridge和交换机Switch
        隔离碰撞域, 连接局域网, 转发数据帧
    L3
        路由器Router
        隔离广播域, 连接互联网, 寻路, 转发或丢弃分组
        有多个对应不同接口的MAC地址以及多个对应不同网络的IP地址
        (MAC和IP原则上一一对应)
    L4到L7
        网关Gateway
        高层协议互相转换, 应用层网关, 传输层网关, 安全网关等
        安全网关
            又叫防火墙
            用于连接内外网络, 进行安全考虑的协议过滤, 包过滤, 内容过滤等