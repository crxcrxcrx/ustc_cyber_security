4 数据链路层的LLC子层(通用)

4.1 数据链路层的基本概念与功能
    MAC
        Medium Access Control
        媒体访问控制
    ARQ
        Automatic Repeat reQuest
        自动重传请求
    FEC
        Forward Error Correction
        前向纠错
    HEC 
        Hybrid Error Correction
        混合纠错
    链路
        连接相邻结点的通信信道, 分为点对点和点对多点
        点对点链路
            链路两端都只有一个节点, 带宽独占
        点对多点链路
            链路上多个节点, 带宽共享, 需要MAC机制来控制访问
        物理链路之外, 还需要通讯协议控制数据传输, 协议通过软件或硬件实现
        通信方式分为单工, 半双工, 全双工, 全双工分为时分双工和频分双工
    数据链路层
        向网络层提供良好服务接口
            无确认无连接的服务(有线局域网)
            有确认无连接的服务(无线局域网)
            面向连接的服务(无线城域网)
        将物理层的比特流编辑成帧
            成帧目的
                成帧利于出错之后在数据链路层重发
                数据链路层以帧为单位进行发送
                共享链路以帧为单位进行竞争信道
            比特流->帧的方法
                字符计数法
                    每个帧的头部表明帧的长度
                    但是出错会有连锁效应
                含字节填充的分界符法
                    用特殊字符flag标志帧的起始和结尾
                    若在被发送的数据里有标志字节flag, 则前插转义符esc
                含位填充的分界符法
                    用特殊位序列表示帧的起始和结尾
                    若被发送的数据里有该特殊位序列, 则需要规避
                物理层编码违例法
                    用特殊的物理位信号表示帧的起始和结尾
        差错控制与可靠性
            有确认服务, 收方需对收到的数据帧通过返回特别控制帧来确认
            端到端的确认也可以把确认信息整合到一个数据帧上捎带确认
            若数据丢失则通过计数器超时重发, 因此需要对帧编号
            ARQ 
                发->能检错的冗余信息->收
                收->确认->发
            FEC
                发->能纠错的冗余信息->收
            HEC
                发->能检错和纠错的冗余信息->收
                收->确认->发
        流量控制
            发端发送或网络传输速度大于收端接受或网络传输速度时需流量控制
            可在数据链路层及以上的其他各层实现, 可用窗口机制
        介质访问控制(局域网)
            MAC与LLC子层

4.2 差错检测与纠正
    CRC
        Cyclic Redundancy Check
        循环冗余校验, 多项式编码
    FCS 
        Frame Check Series
        帧检验序列
    检错码+确认重传
        噪声小的可靠链路, 电缆或者光纤
        奇偶校验
            直接bit异或
        改进的奇偶校验
            变成矩阵,按列分别异或, 附在最后一行作为冗余位
        CRC 
            对mbit内容生成rbit序列FCS, 共m+rbit码字
            此生成的码字可被事先确定的数整除即无错
            多用于HDLC, PPP, MAC等帧整体的校验
        校验和 Checksum
            数据以16bit一组进行求和
            结果再以16bit一组进行求和直到剩16bit, 得到结果
            最终结果为结果的反码
            多用于IP, TCP, UDP等帧头的校验, 检错能力弱
    纠错码
        噪声大的不可靠链路, 无线电或者单工电路
    纠删码
        检错与纠错混合使用
    检dbit错, 需用最小距离d+1的编码
    纠dbit错, 需用最小距离2d+1的编码
    长n的序列检单bit错, 1位即可
    长n的序列纠单bit错, 需要满足2^r>r+n+1
    Hamming纠错编码, 纠1bit错
        第1, 2, 4, ... 位是校验位
        第K位信息, 即将K分解成2幂次和, 根据每个幂次对应信息位的异或校验

4.3 基本数据链路协议
    无限制的单工协议
        单向传输,绝对理想
        发送方
            从网络层取分组->构造帧->发出帧
            不需要差错控制和流量控制
        接收方
            等待帧到达->取出帧->送给网络层
            无需处理时间, 缓冲空间无限大, 无损坏以及丢帧现象
    无错信道的单工停等协议
        在无限制的单工协议基础上, 接收方改变, 相当于半双工
        发送方
            从网络层取分组->构造帧->发送帧->等待应答帧
            不需要差错控制和流量控制
        接收方
            等待帧到达->取出帧->送给网络层->发送"准备接受下一帧"的应答帧
            需要处理时间, 缓冲空间只有一帧, 无损坏以及丢帧现象
    有噪信道的停等协议
        实际的信道
        信道利用率低, 可通过窗口机制改善(参见下节滑动窗口协议)
        发送方
            从网络层取分组->构造帧->发送帧并启动计时器->等待应答帧
                (收到)->清空计时器并发送下一帧
                (超时)->重传
            有超时机制, 需维护N(S)序列号, 收到确认帧并校验后++
            发送帧正常发送的是当前的数据帧
            超时计时器时间应当稍大于2倍端到端的时间以及接收端处理时间和
        接收方
            等待帧到达->取出帧->验证帧
                (正确)->发送含"确认收到"的应答帧->送给网络层
                (错误)->无效帧丢弃
            有校验机制, 需维护N(R)序列号, 收到数据帧并校验后++
            应答帧正常请求的是下一个想要的数据帧

4.4 滑动窗口协议
    带宽延迟乘积BD=单向延迟*带宽, 链路利用最大值是2BD+1
    BD的单位是bit, B, 帧均可
    链路利用率为W/(2BD+1), W是窗口长度, 单位一般是帧
    是流量控制协议
    发送窗口
        发送端允许不等确认而连续发送帧的序号表
        连续发送帧的最大数量为发送窗口尺寸W_T, 缓冲区实现
        一般情况
            发送端直接按顺序发送窗口内数据帧
        发送端收到发送窗口下沿帧的应答帧时
            滑动窗口, 清理缓冲区
    接收窗口
        接收端允许接收帧的序号表
        允许接收帧的最大数量为接收窗口尺寸W_R, 缓冲区实现
        当接收到窗口外的帧时
            直接丢弃
        当接收到窗口内帧时
            校验正确
                如果不是下沿帧
                    则存缓冲区
                如果是下沿帧
                    则将连续后续帧给网络层
                    回复新接收窗口下沿帧的应答帧
                    滑动窗口, 清理缓冲区
    如果是互发数据, 则可以捎带应答接收窗口下沿帧
    主要的滑动窗口协议有回退N协议和选择重发协议
    停等协议是窗口为1帧的滑动窗口协议
    回退N协议(出错全部重发协议)
        W_T>1, W_R==1
        出错处理
            接收端不发送表示没收到
            发送端检测到超时, 则从丢帧处全部重发
        W_T不可超过2^n-1, n是序号的编码位数, 否则帧重叠
        W_R无缓存要求, 因此一般为1
        发送端需要为每一个帧分别设定一个定时器
    选择重发协议
        W_T>1, W_R>1
        出错处理
            接收端每次接收都发接收端下沿帧的应答帧, 把其它顺延帧缓存
            发送端只需发送对应帧
        一般情况W_T==W_R
            如果>则多出的帧被丢弃浪费信道
            如果<则多出的接收窗口浪费缓存
        W_R不可超过2^(n-1), n是序号的编码位数, 否则帧重叠
        发送端需要为每一个帧分别设定一个定时器

4.5 面向位的协议HDLC(ITU)
    HDLC
        High Level Data Link Control
        高级数据链路控制
    面向位, 有确认无连接
    为平衡链路级操作研制的
    主从结构, 主站命令帧控制从站, 从站响应帧响应主站
    帧格式
        1B    1B  1B   >=0B 2B  1B
        Flag1 Adr Ctrl Data CRC Flag2
    Flag1
        帧标志序列, 0b01111110
    Adr
        全1广播地址, 全0测试地址, 命令帧中是目的地址, 响应帧中是源地址
    Ctrl
        信息帧(Information)
            1bit 3bit 1bit 3bit
            0    Seq  P/F  Next
        监控帧(Supervision)
            1bit 1bit 2bit 1bit 3bit
            1    0    Type P/F  Next
        无编号帧(Unnumbered)
            1bit 1bit 2bit 1bit 3bit
            1    1    Type P/F  Modifier
        Seq
            发送端发送的序列编号, mod8循环
        Next
            发送端准备接受的序列号, mod8循环
        Type
            监控的类型
        Modifier
            修改的类型
        P/F
            命令帧作为询问bit, 响应帧作为终止bit, 有则1
    Data
        数据段有5个连续1时就插入0, 含位填充的分界符法
    CRC
        CRC16, 对从Flag到Data区间进行校验
    Flag2
        帧标志序列, 0b01111110

4.6 面向字节的数据链路层协议PPP(IETF)
    PPP
        Point to Point Protocol
        点对点协议
    LCP
        Link Control Protocol
        链路控制协议
    面向字节, 无确认无连接
    为不同网络层定义了网络控制协议族
    串行链路上数据报封装方法
    LCP
    帧格式
        1B    1B  1B   2B  0<=1500B 2B  1B 
        Flag1 Adr Ctrl Ptc Data     CRC Flag2
    Flag1
        帧标志序列, 0x7E
    Adr
        地址, 0xFF
    Ctrl
        控制内容, 0x03
    Ptc与Data
        0021与IP数据报
        C021与链路控制数据
        8021与网络控制数据
        异步传输
            字符0x7D是转义字符
                0x7E->0x7D5E
                0x7D->0x7D5D
                小于0x20的字符->0x7D**
        同步传输
            数据段有5个连续1时就插入0, 含位填充的分界符法
    CRC 
        CRC16, 对从Flag到Data区间进行校验
    Flag2
        帧标志序列, 0x7E