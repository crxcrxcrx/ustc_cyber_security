5 数据链路层的点对多点链路

5.1 传统LAN基本概念
    LLC 
        Logical Link Control
        逻辑链路控制
    局域网是小区域内数据通信互联的信息网
    局域网的技术目标
        传输数据的传输媒体
        连接设备的拓扑结构
        共享资源的媒体访问控制方法
    早期局域网是基于共享广播式的链路
    802.3是有线局域网(Ethernet)
    802.11是无线局域网(WLAN)
    OSI的数据链路层相当于IEEE802的MAC和LLC层, LLC在MAC之上
    MAC子层
        负责对共享介质访问进行控制
        差错校验
        不同的MAC子层可以有相同的LLC子层, MAC子层针对不同类型局域网不同
    LLC子层
        对所有局域网都相同的
        定义了两个用户交换数据机制
        流量控制
        提供服务
            无确认无连接(有线网络首选项)
            有确认无连接(无线网络等不可靠网络更合适)
            面向连接

5.2 多路访问协议
    Aloha 
        世界上最早的无线电计算机通信网, 在夏威夷大学
    CSMA
        Carrier Sense Multiple Access
        载波侦听多路访问
    DCF
        Distributed Coordination Function
        分布式协调工作模式
    PCF
        Point Coordination Function
        点协调工作模式
    CD
        Collision Detection
        冲突检测
    CA
        Collision Avoidance
        冲突避免
    RTS
        Request To Send
        请求发送
    CTS 
        Clear To Send
        清理发送
    IFS 
        InterFrame Spacing
        帧间间隔
    NAV 
        Network Allocation Vector
        网络分配向量
    为了在多个竞争的用户间分配单个广播信道, 避免冲突
    设计原则
        简单易于实现, 集中式与分布式
        有效的介质利用率
        对用户公平合理
    广播信道的分配问题
        静态分配
            TDM与FDM, 静态占用, 不能有效处理突发数据, 资源浪费较大
        动态分配
            随机访问(争用)
                有了就发, 有冲突再解决
                适用于负载轻的网络, 负载重效率低
                如Aloha, CSMA
            控制访问
                取得发送权再发, 避免冲突
                适用于负载重的网络, 信道利用率很高
                主要有轮询和预约两种方式
                如802.11的PCF模式
        动态信道分配假设
            单信道给所有用户使用
            时间连续或者分槽(随时发或者等时间槽起始点发)
            发送端能否检测冲突(有线容易, 无线难)
            有无载波侦听(有则发送前侦听, 无则直接发)
    Aloha协议
        最早的无线广播信道争用协议
        集中式, 有一个中央计算机
        两个版本
            纯Aloha
                时间连续, 有数据就发
                监听广播看有无冲突, 有就等随机时间之后重发
            时隙Aloha
                时间分槽, 每个时间片可以发送一帧, 有数据则下个时间槽发
                比纯Aloha信道利用率提高一倍
    CSMA协议
        讲前先听, 常见三种
        非坚持式
            讲前先听, 忙则随机等待时间后再听, 直至空闲发送
            无法准确识别空闲时间, 信道利用率低
            缺点
                多个节点短时间内都检测到空闲可能同时发送
        1-坚持式
            讲前先听, 忙则一直听, 直至空闲发送
            若冲突则随机等待时间后再听, 直至空闲发送
            缺点
                信号传输延迟造成冲突
                多节点短时间内都检测到空闲可能同时发送
        p-坚持式(时隙信道)
            讲前先听, 忙则以概率p一直听, 直至空闲发送, 1-p在下一个时间槽发送
            p的选择关乎协议性能, p可以降低同时发送造成冲突的概率
        CSMA/CD
            讲前先听, 忙则一直听, 直至空闲发送(同1-坚持式)
            发送过程中边讲边听, 检测回复信号确认是否冲突
            冲突则取消, 发干扰信号通知, 随机等待后再发(二进制指数退避算法)
            因为范围有限, 有隐藏站点问题和暴露站点问题, 不适用于WLAN
            二进制指数退避算法
                冲突之后,时间分槽, 长度为最差情况往返延迟, 一般51.2us
                第k次冲突
                    若k<=10, 从0到2^k-1中随机选择r, 等r个槽空闲时间后重传
                    若10<k<=16, 从0到2^10-1=1023中选择, 与上一步类似
                    若k>16, 放弃发送, 报错
        CSMA/CA
            DCF是必须要求实现的操作, 所有站点竞争访问信道
            PCF是用AP控制通信, 属于可选操作
            IFS是发送之前的一个时间间隔
                发送帧之前确保IFS内空闲, 之后才能发送, 分三种
                SIFS, Short IFS, 最高优先级, 用于控制帧
                PIFS, PCF的IFS, 为SIFS+1, 用于PCF模式的帧
                DIFS, DCF的IFS, 为SIFS+2, 用于DCF模式的帧
            基本过程
                发送方检测信道是否空闲
                    空闲, IFS时间内检测信道是否空闲
                        一直空闲, 传输, 结束
                        否则, 跳出
                    否则, 跳出
                发送方等待信道空闲, IFS时间内检测信道是否空闲
                    一直空闲, 进入二进制指数退避算法, 结束
                    否则, 继续
            基本过程无法解决隐藏站点和暴露站点问题
            扩展过程(绝大多数802.11都支持)
                发送方等IFS后发送RTS短帧, 内含要发送数据帧长度
                接收方等IFS后回复CTS短帧, 也内含要发送数据帧长度
                发送方等IFS后发送数据帧
                接收方等IFS后发送应答帧
                其他站点侦听RTS后
                    保持足够长沉默时间(由RTS获取的NAV)确保发送方收到CTS
                其他站点侦听CTS后
                    保持足够长沉默时间(由CTS获取的NAV)确保接收方收到数据
                多站点同时发送短帧仍会冲突
                    未收到CTS的发送方随机等待后再发(二进制指数退避算法)

5.3 Ethernet的MAC协议(802.3)
    Ethernet误码率低, LLC一般是无确认非连接服务
    传输介质是有线的
    经典Ethernet
        802.3, 10Mbps
        同轴电缆, 双绞线或光纤
        指明接收者
        利用CSMA/CD竞争, 且帧的数据域不得超过1500B
        为检测到冲突! 最长电缆限制2500m, 最小帧长限制64B
    快速Ethernet
        802.3u, 100Mbps
        双绞线或光纤
        两种互连工作模式
            L1集线器Hub
                利用CSMA/CD竞争, 半双工通信
                为检测到冲突! 最长电缆限制250m, 最小帧长限制64B
            L2交换机Switch(大多数是这种)
                交换机帮忙处理冲突, 无需CSMA/CD, 全双工通信
    千兆Ethernet
        802.3z, 1000Mbps
        双绞线或光纤
        两种互连工作模式
            L1集线器Hub
                利用CSMA/CD竞争, 半双工通信
                为检测到冲突! 理论上最长电缆限制25m, 最小帧长限制64B
                实际上是最长电缆限制200m, 最小帧长限制512B
                为解决电缆长度限制
                    载荷扩充, 把帧扩充长度到512B
                    帧串, 把多个帧连在一起
            L2交换机Switch(大多数是这种)
                交换机帮忙处理冲突, 无需CSMA/CD, 全双工通信
    万兆Ethernet
        802.3ae, 10Gbps
        只能光纤
        提高帧长度, 传输距离更强
        只支持L2交换机Switch的全双工通信
    还有更快的Ethernet, 且各个网络均向下兼容
    Ethernet的MAC帧
        帧格式
            7B 1B  6B 6B 2B  46<=1500B  4B
            PA SFD DM SM Len LLCPDU+Pad CRC
        PA
            先导域, 0b10101010重复7次
        SFD
            帧起始M定界符, 0b10101011
        DM
            目标MAC地址
        SM
            源MAC地址
        Len
            数据长度, 0到1500B, 超过1500B则标识0x0800, 此时高层用IP
        LLCPDU+Pad
            LLC数据帧, Pad为填充, 目的保证该区段至少46B
        CRC
            CRC32, 对从PA到LLCPDU+Pad区间进行校验
        计算帧长度时, PA和SFD不算到长度内, 即最小帧长是64B
        计算机网络帧里, 最高有效字节在左, 字节里的最高有效位在右
        MAC地址
            6B, 前3B由IEEE统一分配给厂家, 后3B厂家写
            组播Multicast, 最高有效位是1则组地址, 0则普通地址
            广播Broadcast, 全1则是广播地址

5.4 WLAN的MAC协议(802.11)
    STA 
        wireless STAtion 
        无线站点, 通过MAC层共享同一个无线信道
    AP
        wireless Access Point
        无线接入点, 有时也叫WAP, 同BS, Base Station基站
    SSID
        Service Set Identifier
        服务集标识符(网络名)
    根据不同工作频率划分信道, 每个信道有频率范围
    优点
        快速部署, 可漫游, 易扩展
    缺点
        速率和效率较有线网低, 安全性差, 终端功耗大
    无中心自组织网络(AdHoc)
        只有STA的网络, 没有AP
        互相都在信号覆盖范围内, 可直接通信
        必须都在同一个频段信道(同一区域最多只能有三个不同的AdHoc)
    基础设施网络
        通过AP使STA通信的网络, 需要STA配置和AP相同的SSID

5.5 网桥
    STP
        Spanning Tree Protocol
        生成树协议
    功能
        局域网的互联设备, 在数据链路层工作
        转发数据帧, 必要时转换帧格式(不能存储)
        可以隔离碰撞域, 不能隔离广播域
        丢弃出错帧
    问题
        802.11持续时间有限, 帧的丢弃与生成导致不同组帧校验和需重算
        802.11较慢, 不同数据速率不同需缓冲来不及传输的帧
        802太长的帧可能被丢弃
        安全性加密问题, 802.11支持加密但是802.3不支持
        服务质量问题, 802.11PCF支持服务质量但是802.3不支持
    透明网桥
        逆向学习法产生目的地址查找表, 包含桥两端的地址
        如果源和目的在同一个区域, 则丢弃帧
        否则, 向除接收端口外转发
        如果成环, 有STP协议
    源路由选择网桥
        (未详细介绍)

5.6 交换式局域网
    功能
        星型拓扑结构, 交换机连接主机, 在数据链路层工作
        可被认为是多端口网桥
        存储转发方式进行交换
        根据目的地址找到输出端口
        如果成环, 有STP协议