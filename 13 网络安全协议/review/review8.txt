8 应用层安全

8.1 电子邮件安全协议
    PEM 
        Privacy Enhanced Email
        隐私保密功能
    MIME 
        Multipurpose Internet Mail Extensions
        多用途互联网邮件扩展
    PGP 
        Pretty Good Privacy
        优良保密协议
    UA 
        User Agent
        用户代理
    MTA
        Message Transfer Agent
        消息传输代理
    MAA
        Message Access Agent
        消息访问代理
    IDEA 
        International Data Encryption Algorithm
        国际数据加密算法
    电子邮件的安全需求
        机密性
        认证
        完整性
        抗否认性
    PGP 
        加密
            一次性会话密钥
                发送端产生
            IDEA/3DES/Cast128对称加密算法加密报文
            RSA收信人公钥非对称加密会话密钥
            两者一起送出
        认证
            SHA1/MD5对报文杂凑
            发信人私钥签名, 采用RSA/DSS
        压缩
            ZIP压缩算法
            签名在压缩前
                便于存储, 减少计算
                防止相同压缩算法产生不同结果导致验证的假性失败
            加密在压缩后
                节省时间
                加大对手密码分析难度
            与IPSec的先ESP加密后AH签名相反
        兼容性
            Radix64将加密的报文转换成ASCII字符进行传输
            将原报文长度扩展了33%
            具体操作
                3个8bit字节重新分割成4个6bit部分
                    如果不足3个8bit则进行补0字节
                    补几个字节就在结果后加几个=
                查找ASCII代码表进行6bit到8bit的字符编码
        数据分段
            PGP可分段组装, 适应最大消息长度限制
            最大报文长度在50000字节, 超长必须分段
            PGP自动分段
            接收端重组
        加密密钥和密钥环
            PGP需四种类型密钥
                一次性会话对称密钥
                公钥
                私钥
                对称密钥的口令
            需求
                需生成不可预测的会话密钥
                需标识具体密钥, 因为一个用户有多个公私钥对, 以便及时更换
                需维护一个保存公私钥对的文件和保存通信对方公钥的文件
            密钥标识符
                用于标识公私钥对
                将标识符与公钥关联, 对用户一一对应即可
                定义KeyID, 有64个有效位
            密钥环
                KeyID用于标识所使用的发送者和接收者的密钥号
                    两个KeyID包含任何PGP消息中提供保密与认证功能
                    需系统化方法存储和组织key以保证使用
                PGP在每个节点上提供一对数据结构
                    保存该节点拥有的公私钥对和私钥环
                    存储本节点知道的其他用户的公钥环
            报文内容
                会话密钥内容
                    接收者公钥的KeyID
                    会话密钥, 需接收者公钥加密
                签名
                    时间戳
                    发送者公钥的KeyID 
                    判断是否使用了正确公钥解密用的摘要
                    发送者私钥签名 
                信息
                    文件名
                    时间戳
                    报文数据
            报文压缩范围和加密范围是签名与信息
            报文Radix64范围是整个报文
    S/MIME
        商业机构邮件安全的工业标准
        而PGP是个人邮件安全
        和SMTP相比, 是SMTP的功能扩展
            解决了不能传非文本二进制码的问题
            解决了只能传输7位ascii码不支持其他字符的问题
        和PGP相比, 是PGP的安全强化
            使用了X.509规范

8.2 远程登陆的安全协议
    SSH 
        Secure SHell
        远程登陆安全协议
    有两个版本, 互不兼容
    体系
        SSH传输层协议
            提供服务器主机认证
            提供数据加密
            提供数据完整性支持
        SSH认证协议
            为服务器提供用户身份认证
        SSH连接协议
            加密信息隧道复用若干逻辑通道给高层应用

8.3 web安全协议
    HTTPS
        HyperText Transfer Protocol over Secure socket layer 
        安全套接层的超文本传输协议 
    被加密内容
        请求文件的URL
        文件内容
        浏览器表单内容
        cookie
        http头标
    建立连接
        客户同时扮演HTTP应用层客户端和TLS传输层客户端角色
        在TCP握手完成之后
        先TLS握手, 再HTTP请求
        可建立多个连接
    取消连接
        先关闭HTTP
        再关闭SSL
        最后关闭TCP

8.4 SET协议
    SET 
        Secure Electronic Transaction
        安全电子交易协议
    提供了消费者, 商家, 银行三方之间认证
        保密性
            常用DES加密
                支付信息
                订货信息
        数据完整性
            SHA1+RSA数字签名
            SHA1+HMAC保护
        不可抵赖
            利用签名的私钥绑定用户
        用户认证
            X.509v3证书对持卡人和商家认证
    特点
        不把消费者的支付信息给商家
        不把消费者的订货信息给银行
        公钥密码体制, X.509标准 
    系统组成
        持卡人, 银行卡持有者
        商家, 出售商品的机构
        发卡行, 为持卡人建立账户并发行支付卡的金融机构
        收单行, 为商家建立账户并处理支付卡授权和支付的金融机构
        支付网关, 收单行操作的设备, 用于认证商家和持卡人并处理支付信息
    处理流程
        持卡人->商家   访问商店选定商品
        持卡人->商家   订货信息和支付信息
        商家->收单行   支付信息
        收单行->发卡行 请求支付认可
        发卡行->收单行 支付授权
        收单行->商家   授权确认消息
        商家->持卡人   提供服务
        发卡行->持卡人 信用卡账单
    双重签名
        支付信息与订货信息分别摘要, 然后两个摘要放一起再做摘要
        持卡人对最后的摘要进行私钥签名 
    商家收到的持卡人购买请求
        需商家转发的支付内容
            临时对称密钥加密的
                支付信息
                双重签名
                订货信息摘要
            双重信封
                收单行公钥加密的
                    临时对称密钥
        支付信息摘要 
        订单信息
        双重签名
        持卡人证书